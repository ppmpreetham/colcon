<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Previewer</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #custom-font-style {
            display: none;
        }
    </style>
    <style id="custom-font-style"></style>
</head>
<body>
    <div style="display: flex; align-items: flex-start; justify-content: flex-start; position: absolute; top: 0; left: 0;">
        <label for="background-color-input" style="margin-top: 0.7vh;">Background color:</label>
        <input type="color" id="background-color-input" oninput="changeBackgroundColor()" value="#ffffff">
    </div>

    <div style="display: flex; align-items: flex-start; justify-content: flex-start; position: absolute; top: 30px; left: 0;">
        <label for="foreground-color-input" style="margin-top: 0.7vh;">Foreground color:</label>
        <input type="color" id="foreground-color-input" oninput="changeForegroundColor()" value="#ffffff">
    </div>

    <div style="display: flex; align-items: flex-start; justify-content: flex-start; position: absolute; top: 60px; left: 0;">
        <label for="font-size-slider">Font size:</label>
        <input type="range" id="font-size-slider" min="10" max="50" value="30" oninput="changeFontSize()">
    </div>
    
    <div style="display: flex; align-items: flex-start; justify-content: flex-start; position: absolute; top: 90px; left: 0;">
        <label for="font-file">Font Family:</label>
        <input type="file" id="font-file" accept=".ttf,.otf,.woff,.woff2" onchange="loadCustomFont()">
    </div>

    <div style="position: absolute; top: 120px; left: 0;">
        <p id="luminance-output"></p>
    </div>

    <p id="content" style="font-family: inherit; font-size: 30px; outline: none;" contenteditable>The quick brown fox jumps over the lazy dog</p>

    <script>
        function changeFontSize() {
            const fontSize = document.getElementById('font-size-slider').value;
            document.getElementById('content').style.fontSize = fontSize + 'px';
        }

        function changeBackgroundColor() {
            const color = document.getElementById('background-color-input').value;
            document.body.style.backgroundColor = color;
            updateLuminanceValue();
        }

        function changeForegroundColor() {
            const color = document.getElementById('foreground-color-input').value;
            document.getElementById('content').style.color = color;
            updateLuminanceValue();
        }

        function getLuminance(id){
            // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
            const color = document.getElementById(id).value;
            const r = parseInt(color.substring(1, 3), 16) / 255;
            const g = parseInt(color.substring(3, 5), 16) / 255;
            const b = parseInt(color.substring(5, 7), 16) / 255;

            const R = r <= 0.03928 ? r / 12.92 : ((r + 0.055) / 1.055) ** 2.4;
            const G = g <= 0.03928 ? g / 12.92 : ((g + 0.055) / 1.055) ** 2.4;
            const B = b <= 0.03928 ? b / 12.92 : ((b + 0.055) / 1.055) ** 2.4;

            const luminance = 0.2126 * R + 0.7152 * G + 0.0722 * B;
            return luminance;
        }

        function contrast_ratio(){
            const L1 = getLuminance('background-color-input');
            const L2 = getLuminance('foreground-color-input');
            const ratio = (Math.max(L1, L2) + 0.05) / (Math.min(L1, L2) + 0.05);
            return ratio;
        }

        function updateLuminanceValue() {
            const backgroundLuminance = getLuminance('background-color-input');
            const foregroundLuminance = getLuminance('foreground-color-input');
            const contrastRatio = contrast_ratio();

            const luminanceOutput = document.getElementById('luminance-output');
            luminanceOutput.innerHTML = `Background luminance: ${backgroundLuminance.toFixed(3)}<br>
Foreground luminance: ${foregroundLuminance.toFixed(3)}<br>
Contrast ratio: ${contrastRatio.toFixed(3)}`;
        }

        function loadCustomFont() {
            const fontFile = document.getElementById('font-file').files[0];

            // Font Face API !?
            if ('FontFace' in window) {
                const fontFamily = 'My Custom Font';

                const customFontStyle = document.getElementById('custom-font-style');
                customFontStyle.innerHTML = `
                    @font-face {
                        font-family: '${fontFamily}';
                        src: url(${URL.createObjectURL(fontFile)}) format('${getFontFormat(fontFile.name)}');
                        font-weight: normal;
                        font-style: normal;
                    }

                    #content {
                        font-family: '${fontFamily}', sans-serif;
                    }
                `;

                const customFont = new FontFace(fontFamily, `
                    url(${URL.createObjectURL(fontFile)}) format('${getFontFormat(fontFile.name)}')
                `, {
                    weight: 'normal',
                    style: 'normal'
                });
                
                customFont.load().then((font) => {
                    document.fonts.add(font);
                    document.getElementById('content').style.fontFamily = `"${fontFamily}", sans-serif`;
                }).catch((error) => {
                    console.error('Error loading custom font:', error);
                });
            } else {
                console.error('Font Face API is not supported in this browser.');
            }
        }

        function getFontFormat(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            switch (extension) {
                case 'ttf':
                    return 'truetype';
                case 'otf':
                    return 'opentype';
                case 'woff':
                    return 'woff';
                case 'woff2':
                    return 'woff2';
                default:
                    return '';
            }
        }
    </script>
</body>
</html>